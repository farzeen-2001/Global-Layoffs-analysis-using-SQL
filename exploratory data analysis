look at the max total laid off and percent laid off 

select max(total_laid_off),max(percentage_laid_off)
from layoffs_staging2;

select *
from layoffs_staging2
where percentage_laid_off=1
order by funds_raised_millions desc;

-- find the sum of total laid off by the company and order by desc this helps in finding which compnay had the max layoffs
-- amazon has the highest layoffs 
select company,sum(total_laid_off)
from layoffs_staging2
group by company
order by 2 desc;

 -- find the min and max date to know when it all started and ended
 
 select min(`date`),max(`date`)
 from layoffs_staging2;
 
 -- find the sum of the laid off by the industry to understand which company experienced the highest layoffs
 -- consumer industry has the highest layoffs
 
select industry,sum(total_laid_off)
from layoffs_staging2
group by industry
order by 2 desc;


select country,sum(total_laid_off)
from layoffs_staging2
group by country
order by 2 desc;

-- we need to find the sum of layoffs through date and more specifically years so use YEAR 

select year(`date`),sum(total_laid_off)
from layoffs_staging2
group by  year(`date`)
order by 1 desc;


select stage,sum(total_laid_off)
from layoffs_staging2
group by stage
order by 2 desc;

-- find the roll offs of layoffs using date substring(string,start position,length)

select substring(`date`,6,2) as `month`,sum(total_laid_off)
from layoffs_staging2
group by `month`;


select substring(`date`,1,7) as `MONTH`,sum(total_laid_off)
from layoffs_staging2
where substring(`date`,1,7) is not null
group by `MONTH`
order by 1 asc;

--  rolling total acts as cummulative of sum laid off so it add off the sum from prev month using cte


with ROLLING_TOTAL	AS	
(select substring(`date`,1,7) as `MONTH`,sum(total_laid_off) as total_off
from layoffs_staging2
where substring(`date`,1,7) is not null
group by `MONTH`
order by 1 asc
)
select `MONTH`,total_off, 
sum(total_off) over(order by `MONTH`) as rolling_total
from ROLLING_TOTAL;


select company,`date`,sum(total_laid_off)
from layoffs_staging2
group by company,`date`
order by 2 desc;

select company,year(`date`),sum(total_laid_off)
from layoffs_staging2
group by company,year(`date`)
order by company asc;

select company,year(`date`),sum(total_laid_off)
from layoffs_staging2
group by company,year(`date`)
order by 3 desc;
